<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>工程化管理工具</title>
    <!-- 引入地图引擎库 -->
    <script
      include="leaflet"
      src="http://webclient.smaryun.com/static/libs/include-lib-local-upgrade.js"
    ></script>
    <!--示例中面板、按钮等，第三方layui的js库与css样式-->
    <script src="http://webclient.smaryun.com/static/libs/cdn/layui/layui.js"></script>
    <link
      rel="stylesheet"
      href="http://webclient.smaryun.com/static/libs/cdn/layui/css/layui.css"
    />
    <!--示例公共样式-->
    <link
      rel="stylesheet"
      href="http://webclient.smaryun.com/static/libs/css/style.css"
    />
    <link
      rel="stylesheet"
      href="http://webclient.smaryun.com/static/libs/css/analyse.css"
    />
    <script type="text/javascript">
      //使用严格模式
      'use strict'
      // 定义视图的主要类
      let map, mapView, view
      const { Map } = zondy

      // 初始化地图
      function init() {
        // 初始化地图视图
        initView()
      }
      // 初始地图
      function initView() {
        // 初始化图层管理容器
        map = new Map()
        const config = {
          map: {
            id: '9e7d5381-c89e-6707-ca0b-380e49422e69',
            spatialReference: {
              wkid: 4326
            },
            fullExtent: {
              spatialReference: {
                wkid: 4326
              },
              hasZ: false,
              type: 'Extent',
              extensionOptions: {},
              xmin: 114,
              ymin: 29,
              xmax: 115,
              ymax: 30
            },
            layers: [
              {
                id: '2f56dd68-f7af-95d2-de8f-5a84dfcaf0c5',
                description: '图层基类',
                copyright: '中地数码版权所有',
                loadStatus: 'loaded',
                loaded: true,
                tokenKey: 'tk',
                tokenValue: '63c5c4f101d68229494bb45d3bf60277',
                tokenAttachType: 'normal',
                title: '网络瓦片图层',
                minScale: 0,
                maxScale: 0,
                type: 'web-tile',
                visible: true,
                opacity: 1,
                spatialReference: {
                  wkid: 4326
                },
                extent: {
                  spatialReference: {
                    wkid: 4326
                  },
                  hasZ: false,
                  type: 'Extent',
                  extensionOptions: {},
                  xmin: -180,
                  ymin: -90,
                  xmax: 180,
                  ymax: 90
                },
                autoAddTo2D: true,
                autoAddTo3D: true,
                extendProps: {},
                extensionOptions: {},
                httpMethod: 'GET',
                headers: {},
                url: 'http://t1.tianditu.com/DataServer?T=img_c&x={col}&y={row}&l={level}',
                tileInfo: {
                  dpi: -1,
                  format: 'png',
                  origin: {
                    spatialReference: {
                      wkid: 4326
                    },
                    hasZ: false,
                    type: 'Point',
                    extensionOptions: {},
                    coordinates: [-180, 90]
                  },
                  lods: [
                    {
                      level: 0,
                      levelValue: '0',
                      resolution: 1.40625,
                      scale: 591658710.9091313
                    },
                    {
                      level: 1,
                      levelValue: '1',
                      resolution: 0.703125,
                      scale: 295829355.45456564
                    },
                    {
                      level: 2,
                      levelValue: '2',
                      resolution: 0.3515625,
                      scale: 147914677.72728282
                    },
                    {
                      level: 3,
                      levelValue: '3',
                      resolution: 0.17578125,
                      scale: 73957338.86364141
                    },
                    {
                      level: 4,
                      levelValue: '4',
                      resolution: 0.087890625,
                      scale: 36978669.431820706
                    },
                    {
                      level: 5,
                      levelValue: '5',
                      resolution: 0.0439453125,
                      scale: 18489334.715910353
                    },
                    {
                      level: 6,
                      levelValue: '6',
                      resolution: 0.02197265625,
                      scale: 9244667.357955176
                    },
                    {
                      level: 7,
                      levelValue: '7',
                      resolution: 0.010986328125,
                      scale: 4622333.678977588
                    },
                    {
                      level: 8,
                      levelValue: '8',
                      resolution: 0.0054931640625,
                      scale: 2311166.839488794
                    },
                    {
                      level: 9,
                      levelValue: '9',
                      resolution: 0.00274658203125,
                      scale: 1155583.419744397
                    },
                    {
                      level: 10,
                      levelValue: '10',
                      resolution: 0.001373291015625,
                      scale: 577791.7098721985
                    },
                    {
                      level: 11,
                      levelValue: '11',
                      resolution: 0.0006866455078125,
                      scale: 288895.85493609926
                    },
                    {
                      level: 12,
                      levelValue: '12',
                      resolution: 0.00034332275390625,
                      scale: 144447.92746804963
                    },
                    {
                      level: 13,
                      levelValue: '13',
                      resolution: 0.000171661376953125,
                      scale: 72223.96373402482
                    },
                    {
                      level: 14,
                      levelValue: '14',
                      resolution: 0.0000858306884765625,
                      scale: 36111.98186701241
                    },
                    {
                      level: 15,
                      levelValue: '15',
                      resolution: 0.00004291534423828125,
                      scale: 18055.990933506204
                    },
                    {
                      level: 16,
                      levelValue: '16',
                      resolution: 0.000021457672119140625,
                      scale: 9027.995466753102
                    },
                    {
                      level: 17,
                      levelValue: '17',
                      resolution: 0.000010728836059570312,
                      scale: 4513.997733376551
                    },
                    {
                      level: 18,
                      levelValue: '18',
                      resolution: 0.000005364418029785156,
                      scale: 2256.9988666882755
                    }
                  ],
                  size: [256, 256],
                  spatialReference: {
                    wkid: 4326
                  },
                  startLevel: 0,
                  endLevel: 18
                },
                tileSliceType: 'wmts',
                tileDisplayStrategy: 'stretch',
                tileSize: 256,
                subDomains: [],
                clippingArea: null
              }
            ],
            exportTime: '2026-02-05T07:49:55.661Z',
            basemap: null
          },
          scale: 101980292.2604472,
          center: {
            spatialReference: {
              wkid: 4326
            },
            hasZ: false,
            type: 'Point',
            extensionOptions: {},
            coordinates: [0, 0]
          },
          minZoom: 2.6210929999999997,
          maxZoom: 30,
          zoom: 2.6210929999999997,
          extensionOptions: {},
          extendProps: {},
          layerViewFilter: {
            includedIds: null,
            excludedIds: null
          },
          initialGoTo: true,
          mergeLevelRatio: 1.05,
          viewId: 'mapgis-viewer',
          extent: {
            spatialReference: {
              wkid: 4326
            },
            hasZ: false,
            type: 'Extent',
            extensionOptions: {},
            xmin: 114,
            ymin: 29,
            xmax: 115,
            ymax: 30
          },
          animation: true,
          width: 1660,
          height: 919,
          preferCanvas: false,
          spatialReferenceLocked: false
        }
        // 初始化地图视图对象
        if (window.viewType === 'leaflet') {
          view = scenarioManage(config)
        } else if (window.viewType === 'cesium') {
          view = scenarioManage(config)
        } else if (window.viewType === 'mapboxgl') {
          view = scenarioManage(config)
        } else {
          console.error('地图引擎包引入错误')
        }
        window.view = view
      }
      //toJson()方法
      function viewToJson() {
        const res = view.toJSON()
        console.log('res: ', res)
      }
    </script>
    <style>
      .sample-button-panel {
        position: absolute;
        top: 10px;
        right: 10px;
        color: #e1e1e1;
        background-color: rgb(44, 44, 44);
        border: none;
        padding: 10px;
        width: auto;
        z-index: 999;
      }
    </style>
  </head>

  <body onload="init();">
    <!--  视图容器div  -->
    <div
      id="mapgis-viewer"
      style="position: absolute; width: 100%; height: 100%"
    ></div>
    <div class="sample-button-panel">
      <button
        id="toJson"
        type="button"
        class="layui-btn"
        onclick="viewToJson()"
      >
        将json打印到控制台
      </button>
    </div>
  </body>
</html>
